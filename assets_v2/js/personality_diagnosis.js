$(function () {
  // --- 診断結果詳細データ（CSVマトリクスより抽出） ---
  const RESULT_DETAILS = {
    male: {
      1: { intro: "【真面目で責任感の強い男性】", pattern: "物事を正しいか正しくないかで判断しようとします。間違ったことや不正は許せません。理想の姿を求め、高い基準を設けて行動します。理性的であろうとし、秩序立てて物事を処理します。", attitude: "自立心の強い人ですが協調性もあります。誰に対しても平等公平で、嘘やごまかしがなく率直です。情に厚く、昔からの付き合いの友人を大切にします。", traits: "真面目で責任感が強く、自分に対して厳しい面があります。勤勉な努力家で、何事もきちんとしていないと気がすまず、完璧主義な面があります。", marriage: "恋愛・結婚についても真面目です。遊び半分のような交際はしません。夫婦は一生添い遂げるべきものと考え、多少の我慢と忍耐は必要だと思っています。", partner1Type: "タイプ６", partner1Rel: "常識があり、家庭のことをしっかり受け持ってくれる女性。あまり我が強すぎず、周囲と仲良くやっていける方がおすすめです。", partner1App: "こだわりを述べるより、相手の方がリラックスできる雰囲気作りを。軽い冗談やユーモアを取り入れて緊張を解きましょう。", partner2Type: "タイプ４", partner2Rel: "情緒性があり、フェミニンなやさしさのある女性。日々の生活に潤いをもたらしてくれるパートナーが合っています。", partner2App: "お相手の方がどういう趣味を持ち、何を好むのかを尋ねてみましょう。お互いの感覚が合いそうかじっくり感じ取ってください。", failFactor: "お相手に対してかなり厳しい基準をお持ちのようです。欠点や至らない点に目を向けがちで、パーフェクトを求めすぎていませんか？", advice: "「こうでなければならない」を一度手放し、相手のいいところに目を向けましょう。ポジティブな見方をすれば、相手も心を開いてくれます。" },
      2: { intro: "【やさしく思いやりのある男性】", pattern: "理屈よりも気持ちを大切にする人です。物事の見通しは楽観的で、ポジティブな反応を示します。ネガティブな感情は表に出さないようにします。", attitude: "協調性があり、つねに周りを気遣っています。自分から人に親切にし、喜ばせることを好みます。困っている人を放っておけず、自分より他人を優先します。", traits: "親切で思いやりのある人です。人から必要とされ、人の役に立てることに大きな喜びを感じます。世話好きで、お人よしの傾向があります。", marriage: "愛する人のために尽くすタイプ。好きな人が喜ぶことが自分の喜びになります。家庭では妻や子供との時間を大切にし、親戚付き合いも丁寧です。", partner1Type: "タイプ２", partner1Rel: "同じように温かいハートを持っている女性がおすすめ。いつも笑顔を絶やさない家庭的な方となら会話も弾み、仲良くなれるでしょう。", partner1App: "友達止まりになりがちです。ストレートに結婚生活の夢や、お互いが思い描いている理想の家庭のイメージなどを話し合ったほうがいいでしょう。", partner2Type: "タイプ４", partner2Rel: "内気で恥ずかしがり屋、どこか繊細で傷つきやすそうな女性に魅力を感じるはず。趣味のいいものに囲まれた暮らしを好む方と合います。", partner2App: "相手の気持ちに寄り添い、好みを理解しようとする姿勢を見せてください。たとえ気まぐれな態度を見せても、温かく受け止めてあげましょう。", failFactor: "やさしさが「誰にでも親切な人」と思われたり、「いい人なんだけど」といい人止まりで終わってしまうこともありそうです。", advice: "やさしさだけでなく男らしさも強調しましょう。相手が話したがらないことは無理に聞き出そうとせず、話してくれるまで時間を置きましょう。" },
      3: { intro: "【野心的で行動力のある男性】", pattern: "合理的に割り切った考えができる人。現実的に物事を受け止め、臨機応変に対応できます。目標を設定し、最短距離でやり遂げようとする効率重視派です。", attitude: "第一印象を大切にし、自分をアピールするのが得意。チームの中ではリーダー的な立場を引き受けることができます。ビジネスライクな関係を好みます。", traits: "価値ある人間でありたいという気持ちが強い人です。自分の実力が認められ評価されることを望みます。人に負けたくない競争心も強いです。", marriage: "女性からカッコよく見られるよう外見にも気を配ります。結婚は現実的に考え、良い条件を比較して選ぶ割り切りができる人です。", partner1Type: "タイプ３", partner1Rel: "華のある魅力的な女性に惹かれるでしょう。積極的でテキパキした態度振舞いのできる女性となら価値観を共有できるはずです。", partner1App: "自信を持って行動しましょう。あなたが抱いている野心や仕事への熱意を伝えましょう。理想の家庭像が一致すれば進展は早いです。", partner2Type: "タイプ７", partner2Rel: "社交性があって元気で明るい女性がふさわしいです。仕事関係にも紹介でき、家の中を明るくしてくれるパートナーになります。", partner2App: "どちらも社交的なので、すぐに親しくなれるでしょう。お互いに好感を抱けば、デートのお誘いなどもためらわずに行動しましょう。", failFactor: "格好をつけようとして見栄を張ったり、自慢話をしたりしがちです。自慢話が多い人と思われると、それはマイナス印象になりかねません。", advice: "理想を演じるより自然体で接しましょう。相手はあなたの人柄を知りたいはず。普段着でデートできるようなリラックス感が大切です。" },
      4: { intro: "【情緒豊かで美意識の高い男性】", pattern: "繊細な感受性を持ち、フィーリングで判断します。自分自身の感じ方に従い、人と違ったユニークな視点を持つ人。情緒的で気分の揺れ動きがあります。", attitude: "内向的で、人の目に映る自分を意識します。孤独を愛する人ですが、長く一人でいると寂しくなり、理解者を切実に求めるタイプです。", traits: "想像力豊かでアートやクリエイティブな世界に関心があります。繊細で傷つきやすい面もありますが、人の悲しみに共感的に寄り添える人です。", marriage: "ロマンチックな関係を夢見ています。自分には平凡な恋愛や結婚は向いていないと思うこともありますが、心から分かり合える相手を求めます。", partner1Type: "タイプ１", partner1Rel: "まじめでしっかり者のお相手がおすすめ。揺れ動くあなたの気持ちをしっかりと受け止めてくれ、安定した暮らしが送れるでしょう。", partner1App: "約束事をきちんと守ることが信頼の鍵です。時間やルールを守る誠実さを見せましょう。メールやSNSは自分を伝える有効なツールになります。", partner2Type: "タイプ２", partner2Rel: "気持ちが温かくて思いやりのある女性がおすすめ。家庭的で人の世話を焼くことが苦にならない方となら感情を分かち合えます。", partner2App: "相手の気遣いに感謝を伝えましょう。自分の気持ちを素直に話したり、子供の頃の思い出話をしたりして、距離を縮めていきましょう。", failFactor: "相手を想像の中で理想化しすぎて、リアルな相手を見ていない場合があります。後で失望することになりがちです。", advice: "想像で判断するのではなく、相手の話に耳を傾け、ありのままを知る努力をしましょう。思い込みを捨てることが大切です。" },
      5: { intro: "【冷静で思慮深い男性】", pattern: "物事を冷静に受け止め、客観的に見ることのできる人です。論理的に考え、分析的に判断します。納得するまで考えるタイプで、準備に時間をかけます。", attitude: "人から離れて一人でいることを好みます。一般的な人付き合いには苦手意識があり、世間話や雑談には興味が持てません。専門分野の理解者を求めます。", traits: "内向的な人で、感情をあまり出しません。斬新なアイデアを展開することもあり、私生活では欲がなく、少ないものでやっていけるタイプです。", marriage: "「愛や結婚とは何か」を深く考えてしまうタイプ。一人になれる時間と空間を保てる関係を理想とします。自分は一生結婚できないかもと思うことも。", partner1Type: "タイプ５", partner1Rel: "同じように物静かで知的な方をおすすめします。お互いに自分だけのスペースと時間を大切にでき、尊敬し合える関係になります。", partner1App: "趣味や仕事の専門領域の話から始めてみましょう。ふだんは語らない、自分の好き嫌いなど簡単な感情についても語ってみてください。", partner2Type: "タイプ６", partner2Rel: "生活の仕方を尊重してくれる、あまり感情的にならない女性。きちんと物事を整理でき、家計管理も上手にやっていける方がふさわしいです。", partner2App: "あなたが信頼できる人か、安心感を持てる人かをお相手は知りたがっています。プライベートな生活の様子なども少しずつお話ししましょう。", failFactor: "何を考えているかよくわからないと思われがちです。反応が乏しいと、興味がないと思われてしまい、次につなげることが難しくなります。", advice: "雑談が苦手でも話をしましょう。差し障りのない質問を相手にしてみるだけで、「自分に興味を持ってくれている」と相手は喜びます。" },
      6: { intro: "【誠実で義務を果たせる男性】", pattern: "規則や規範、秩序を重んじます。危機管理意識が高く、ネガティブな可能性を想定して慎重に行動します。有事には誰よりも勇敢になります。", attitude: "協調性があり、組織の一員としての誇りを持ちます。上下関係を意識し、目上の人に礼儀正しく、仲間との付き合いを大切にする誠実な人です。", traits: "責任感が強く几帳面。ルールやマニュアルに従い、コツコツと順番通りに進めるのが得意です。用心深く、守りたいもののために力を発揮します。", marriage: "男らしさにこだわり、保守的な考えを持っています。親戚付き合いも考え、身元のしっかりした人を求めます。内では妻に甘えたい面も。", partner1Type: "タイプ２", partner1Rel: "明るく家庭的で思いやりのある女性がおすすめ。親戚付き合いも丁寧にしてくれる方となら、温かい家庭が築けそうです。", partner1App: "相手が自分に好意を持ってくれているのか、遠慮せず率直な気持ちを尋ねてみましょう。あなたの将来設計についても話し合ってください。", partner2Type: "タイプ７", partner2Rel: "社交的で楽天的な性格の女性がおすすめ。風通しのいい家庭になり、あなたの考えすぎを和らげ、レジャーも一緒に楽しめるでしょう。", partner2App: "一緒にいて楽しいと思ってもらうのが第一。トレンドの場所などへデートに誘いましょう。返事をもらえるまでにあまり時間はかからない相手です。", failFactor: "好意を抱いた相手に対してもすぐ迷いが生じ、「本当にこの人でいいのか」と考えすぎてタイミングを逃してしまうことがありそうです。", advice: "価値観の違いは当然と受け止め、迷いは心に留めず、しっかりと向き合ってコミュニケーションをはかりましょう。" },
      7: { intro: "【楽天的で好奇心旺盛な男性】", pattern: "何事もいい方に解釈します。終わったことは悔やまず、次々と新しい計画を立てます。活発に動き回り、じっとしていることがありません。", attitude: "物おじせず、明るく活発。誰とでもすぐ親しくなれ、場を盛り上げて周りを元気づけます。人付き合いは広く浅く、執着しないタイプです。", traits: "いつも前向き。呑み込みが早く器用なので、同時に複数のことを並行してこなせます。新しい体験のチャンスを逃したくない好奇心旺盛な人です。", marriage: "付き合って楽しい人が一番。フィーリングが合うかどうかが決め手です。意気投合すれば、あまり迷うことなく決断できるでしょう。", partner1Type: "タイプ１", partner1Rel: "まじめで常識のある女性がいいでしょう。つい家庭の外へ関心が向かいがちなあなたを、家庭にしっかり繋ぎ止めてくれます。", partner1App: "楽しい話だけでなく、現実に即した将来の話もしっかりしましょう。ころころ話題を変えず、相手の話にもじっくり耳を傾けましょう。", partner2Type: "タイプ３", partner2Rel: "積極性があり行動的な女性。二人の活動量やエネルギーが釣り合っていて、会話も弾み、意欲的に働いたりお稽古事をしたりする相手です。", partner2App: "自分の誇れる実績を遠慮せず話しましょう。相手はスペックを気にしています。また相手の魅力的なところを言葉にして褒めてあげてください。", failFactor: "束縛を嫌い、結婚に踏み切るのが惜しくなることが。目移りしやすいあなたを、女性も結婚相手としてはどうかとためらうかもしれません。", advice: "「明るく幸せな家庭を築けそう」と思ってもらえるアピールを。今目の前にいる方とじっくり向き合う時間を作ってください。" },
      8: { intro: "【エネルギッシュでチャレンジ精神旺盛な男性】", pattern: "直感で即決即断します。考えるより先に行動するパワフルな人。逆境に強く、困難な時にもへこたれません。裏表がなく率直です。", attitude: "ストレートに自分を主張します。自立心が強く、人に頼るのを嫌いますが、頼られると放っておけない親分肌なところがあります。", traits: "チャレンジ精神旺盛でリスクを恐れません。人は人、自分は自分というゴーイング・マイ・ウェイですが、面倒見がよく無邪気な面もあります。", marriage: "好意を持った相手にはストレート。恋の駆け引きは好みません。支配欲と自立心の両方を持ち、お互いに干渉し合わない関係を望みます。", partner1Type: "タイプ８", partner1Rel: "あなたと同じくらい活力があって、男勝りな性格の方が相性が良いです。思ったことをはっきり言い合える対等な関係になれるでしょう。", partner1App: "好意をうまく伝えられず、関心のないふりをしてしまう不器用な面も。気持ちを「弱み」と捉えず、素直にプッシュしていきましょう。", partner2Type: "タイプ９", partner2Rel: "温和で落ち着きのある女性。強気なあなたに急かされない、マイペースな相手とリラックスして過ごせ、一緒に飲食を楽しめます。", partner2App: "相手はおっとりしているので、あなたがリードして段取りを組みましょう。「イエス・ノー」をはっきりもらうように進めてください。", failFactor: "強引な面が目立ったり、言葉足らずで誤解を与えたり。相手に早く結論を求めすぎて自分から話を壊してしまうことがあるようです。", advice: "決断を急がず、忍耐強く待ちましょう。迷ってなかなか返事ができない方もいます。時間をかければうまくいく話もたくさんあります。" },
      9: { intro: "【温厚で落ち着きのある男性】", pattern: "何があっても大丈夫と楽観的に構え、平和を好みます。ゆったりした時間の中で、長い時間をかけて粘り強く物事に取り組みます。", attitude: "付き合いは受け身的。みんなの中に溶け込んでいて目立ちませんが、他人の話を否定せず黙ってうなずける仲介役になれる人です。", traits: "情緒安定していて自然体。温かい雰囲気があり、波風を立てず変化の少ない平穏な暮らしを望みます。いったん動くと底力を発揮します。", marriage: "恋には受け身。相手からのアプローチを好みます。恋人と気持ちの上で同化し、家庭でも相手に合わせ平和に過ごそうとします。", partner1Type: "タイプ８", partner1Rel: "元気でエネルギーのある女性がおすすめ。背中を押してくれるような積極的な相手に、あなたは魅力を感じるはずです。", partner1App: "「言わなくても伝わっている」という曖昧な態度は禁物。伝えるべきことははっきり言葉にし、伝わっているか確認をしましょう。", partner2Type: "タイプ９", partner2Rel: "同じようにおおらかで落ち着いた女性。時間感覚が似ているので結論を急がず相性を確かめられ、波長の合う穏やかな家庭になります。", partner2App: "どちらも受け身なので、あなたが少しおしゃべりになったり積極的になる工夫を。時間をかけてお互いを理解する会話をしましょう。", failFactor: "自己アピールが不足し、意思表示が不明確。煮え切らない人と思われたり、言葉数が少なすぎて誤解を与えたりすることがあります。", advice: "意思表示をはっきりさせ、必要なことは伝えましょう。「イエス・ノー」を言葉にすること。コミュニケーションのスキルを磨きましょう。" }
    },
    female: {
      1: { intro: "【まじめで落ち着きのある女性】", pattern: "善悪や正しさで物事を判断し、正しい選択をしようと努めます。「こうあるべき」という基準に従い、秩序立てて処理できる人です。", attitude: "自立心と協調性のバランスが良く、節度やマナーを守ります。周囲からは信頼できるしっかり者という印象を持たれます。", traits: "責任感が強く自分に厳しい努力家。いい加減なことが嫌いで、社会がより善い方向に向かうよう自分にできることをやろうとします。", marriage: "恋愛も結婚も誠実に真面目に考えます。一生添い遂げるものという信念があり、相手にも誠実さと信頼を求めます。", partner1Type: "タイプ７", partner1Rel: "明るくポジティブな男性がおすすめ。活発な方ならあなたも気楽に付き合え、人生の楽しみを分かち合える相性です。", partner1App: "相手の話のテンポに合わせてみましょう。笑顔を忘れず、一緒にいて楽しいと感じられるような会話を心がけてください。", partner2Type: "タイプ６", partner2Rel: "常識を大切にし、将来設計を描いている方がふさわしい。外では忠実に働き、内では家族を大切にする方と堅実な家庭を築けます。", partner2App: "あなた自身の家族や友人の話をすると親しみを持ってもらえます。お相手の将来の夢を聞き、価値観が近いか確かめましょう。", failFactor: "お相手に厳しい基準を持ちすぎていませんか？欠点ばかりに目が向き、減点方式で判断して可能性を狭めているかもしれません。", advice: "「こうでなければならない」を一度手放し、間口を広げて。相手のいいところを見つけて口に出して褒める習慣をつけましょう。" },
      2: { intro: "【やさしく思いやりのある女性】", pattern: "理屈よりもハートで受け止めるタイプ。見通しは楽観的で、ポジティブな気働きを常に行動に移すタイプです。", attitude: "親切で友好的。自分より他人を優先し、人を喜ばせることが幸せにつながる人。謙遜で、人にお譲りするようなやさしさがあります。", traits: "愛情豊かで世話好き。見返りを求めずおもてなしができます。困っている人のために自分の時間を費やして働く奉仕の精神があります。", marriage: "愛する人のために尽くすタイプ。愛の絆で結ばれた温かい家庭を築くのが夢で、親密な距離感を好みます。", partner1Type: "タイプ３", partner1Rel: "野心家で仕事熱心な方がおすすめ。成功を目指して頑張る相手は、あなたにとって尽くしがいのある頼もしい存在です。", partner1App: "あか抜けた服装を心がけ、あなたの魅力を引き出しましょう。相手の自慢話には「すごいね」と褒めてあげるのが効果的です。", partner2Type: "タイプ４", partner2Rel: "プライベートを大切にする方も。良い趣味を持ち、暮らしを味わっている方と豊かな時間を過ごせます。音楽や芸術を愛する相手です。", partner2App: "お相手のこだわりに共感を示しましょう。先回りして気を使わず、落ち着いて一緒に過ごす時間を大切にしてください。", failFactor: "「誰にでもやさしい」と思われたり、尽くしすぎて相手が重荷に感じたり、「いい人止まり」で終わってしまう可能性があります。", advice: "自分が動かなくてもいい時はじっとしている忍耐も必要。世話を焼きすぎないように気をつけ、やさしさのメリハリをつけましょう。" },
      3: { intro: "【自分の魅力をアピールできる女性】", pattern: "合理的で臨機応変。目標を最短距離で達成しようとするスマートなタイプ。理性的に物事を処理できるテキパキした人です。", attitude: "積極的に関わり、意見を主張できます。大勢の中でも目立ちやすく華があります。自分に自信を持ち、いい印象を与えるのが上手です。", traits: "能力や魅力を磨く努力を惜しみません。誰からも賞賛される、価値のある成功した人生を送りたいと願っています。", marriage: "経済的ゆとりを重視し、条件も現実的に判断します。理想の条件に合う方となら、結婚後は臨機応変に対応できる人です。", partner1Type: "タイプ３", partner1Rel: "上昇志向が強く仕事熱心な男性がお勧め。共に高め合い、理想の結婚生活のイメージを共有しやすいでしょう。", partner1App: "見栄を張らず、素顔の自分をのぞかせるような自然で率直な態度で接しましょう。自信を持って相手に向き合ってください。", partner2Type: "タイプ７", partner2Rel: "仕事もレジャーも楽しめるマルチな方がお勧め。社交的な二人なら初対面から意気投合し、幸せなプランが描けます。", partner2App: "デートの誘いにもノリよく応じましょう。自然に振る舞えば会話は盛り上がります。また会いたいと思える関係を築きましょう。", failFactor: "スペック（学歴・職業・収入等）にこだわりすぎていませんか？条件でふるいにかけ、人柄そのものを見落としがちです。", advice: "自分をよく見せようと背伸びしがちですが、もう少しリラックスして。気楽な気持ちで接すれば、相手の人柄が見えてきます。" },
      4: { intro: "【内気で繊細、感情が豊かな女性】", pattern: "感受性が強く、感情の揺れ動きが大きい人です。自分の美意識や好みに従い、情緒的なものを大切にする自己表現力の高い人です。", attitude: "引っ込み思案で恥ずかしがり屋。孤独を愛する一方、共感能力が高く、人の苦しみを我がことのように受け止めるやさしさがあります。", traits: "想像力豊かでアートや芸術に関心が高いです。洗練されたものに囲まれて暮らしたいと願い、理解されたい気持ちを強く持っています。", marriage: "ロマンチックな関係と運命の人を夢見ています。心から分かり合えるパートナーを切実に求め、理解者を待っています。", partner1Type: "タイプ１", partner1Rel: "まじめでしっかり者のお相手がおすすめ。堅実な暮らしの中で、あなたの繊細さを好ましいと受け止めてくれる相性です。", partner1App: "メールの返信を早くし、約束の時間を守るなど、基本的なルールを大切に。誠実さが相手の信頼に繋がります。", partner2Type: "タイプ２", partner2Rel: "やさしく思いやりのある方もおすすめ。相手のやさしさを時間をかけて味わえば、頼りがいのある面が見えてくるでしょう。", partner2App: "感じていることを素直に話しましょう。お相手はあなたを喜ばせようとしてくれます。その心遣いに感謝を伝えてください。", failFactor: "現実の相手より、空想の中で理想化しがちです。会う前に期待を高めすぎて、実際に会うと失望しやすい傾向があります。", advice: "空想で迷うより直接会って向き合いましょう。あなたの魅力は直接会ってこそ、深く伝わるようになります。" },
      5: { intro: "【物静かで控えめ、思慮深い女性】", pattern: "冷静に物事を受け止め、客観的に眺めます。納得するまで調べる集中力があり、物事の準備に時間をかける慎重派です。", attitude: "一人を好み、自分から関わりません。雑談や大勢の集まりが苦手で、独自の知識を大切にし、傍で眺めているタイプです。", traits: "内向的で感情を表に出しません。独自の賢明な視点を持ちますが、自分からそれを人に伝えようとはしない知的な人です。", marriage: "「愛とは何か」を深く考える人。結婚後も、自分一人になれる場所と時間を必要とする傾向があります。", partner1Type: "タイプ５", partner1Rel: "同じように物静かで知的な方がおすすめ。静かに過ごせる関係が居心地よく、尊敬し合える家庭になります。", partner1App: "共通の趣味などから話を広げましょう。お互いおしゃべりではないので、メール等をタイミングよく活用するのがポイントです。", partner2Type: "タイプ６", partner2Rel: "まじめで堅実な男性もおすすめ。職務に忠実で家庭を大切にする相手なら、将来を安心して預けることができます。", partner2App: "相手はあなたがどんな人か知りたがっています。家族の話などプライベートなことも織り交ぜて安心感を与えましょう。", failFactor: "「何を考えているかわからない」と思われやすく、反応が乏しいと次につながらないコミュニケーション不足になりがちです。", advice: "言葉数を増やす工夫を。「はい」だけでなく代わりの提案をするなど、話を繋げる意識を持つと出会いが広がります。" },
      6: { intro: "【誠実で相手に合わせられる女性】", pattern: "不安になりやすく用意周到に備えます。頼れるものや安心できるものを求め、役割に忠実に振る舞うタイプです。", attitude: "協調性があり、控えめで周りに合わせます。初対面では緊張しますが、仲間内ではおちゃめな面も見せる礼儀正しい人です。", traits: "几帳面。不安への備えから点検や整理を欠かしません。いざという時は勇敢になり、マニュアル通りに進めるのが得意です。", marriage: "結婚願望が強く、生活の保障と安心安全を求めます。将来の家族計画をしっかり思い描く傾向があります。", partner1Type: "タイプ３", partner1Rel: "野心家で仕事熱心な方が理想。社会的に頑張っている男性は頼もしく、あなたも主婦として支えがいがあるでしょう。", partner1App: "あか抜けたファッションで接しましょう。自分を磨く努力を。堂々と自信を持った態度で接すると好印象です。", partner2Type: "タイプ１", partner2Rel: "まじめで責任感が強い、勤勉な男性もお勧め。金銭感覚も堅実で、年を重ねるごとに信用を築ける相手です。", partner2App: "相手と意見が違っても、率直に自分の考えを伝えましょう。そこからお互いの理解がより深まっていきます。", failFactor: "理想の相手が現れても「自分なんかでいいのか」と臆病になり、迷って決断できなくなることがあるようです。", advice: "「選ばれる側」という意識を捨て、対等な立場で自分の意思を明確にしましょう。受け身にならず気持ちを大切に。" },
      7: { intro: "【明るく社交的な女性】", pattern: "楽観的で前向き。頭の回転が速く器用で、いくつかのことを並行してこなせます。終わったことは悔やみません。", attitude: "社交的で誰とでもすぐ親しくなれます。場を盛り上げるのが得意で、広い付き合いを好み、執着しません。", traits: "好奇心旺盛で楽しい冒険が好きです。辛いことがあっても明るさを失わず、人生を楽しもうとするタイプです。", marriage: "付き合って楽しい人が一番。意気投合すれば迷わず決断します。将来も共に楽しみを分かち合える関係を求めます。", partner1Type: "タイプ６", partner1Rel: "堅実に仕事をしている男性がおすすめ。安定した家庭の中で、一緒にレジャーを楽しめるパートナーになります。", partner1App: "持ち前の明るさを発揮しつつ、礼儀正しい自己紹介を。しゃべりすぎず相手の話を聞く側に回ると好感度アップ。", partner2Type: "タイプ７", partner2Rel: "明るく社交的な方もお勧め。あなたも気楽に付き合え、共に人生の楽しみを分かち合うことができます。", partner2App: "お相手の興味に共感を示し、お付き合いを楽しみましょう。ただし何でも合わせず、自分の予定も優先して。", failFactor: "一人に決められず目移りしがち。「他にもっといい人がいるかも」と未来の可能性に目が向きがちです。", advice: "今目の前にいる方に焦点を合わせましょう。一つひとつの出会いを大切にしないと、本当の適性が見えません。" },
      8: { intro: "【元気ではつらつとした女性】", pattern: "決断力と実行力があり、意思が強いです。考えるよりも行動が先に出るエネルギッシュな人です。", attitude: "ストレートに自分を主張します。自立心が強く他人に頼りませんが、頼られると放っておけない親分肌です。", traits: "パワフルで裏表がありません。困難を恐れず、どんな状況でもへこたれない強さを持っています。無邪気な面もあります。", marriage: "好きになったらストレート。恋の駆け引きはせず、この人ならと思える人に出会った時に結婚を決断します。", partner1Type: "タイプ８", partner1Rel: "同じように野心的な男性がおすすめ。あなたの強さを「魅力的で面白い」と尊重してくれる良きパートナーになります。", partner1App: "初対面は強がってぎこちないかも。でも話し始めれば意気投合。ホンネでぶつかっても大丈夫な相手です。", partner2Type: "タイプ９", partner2Rel: "温厚な方もお勧め。どっしり構えた相手なら、短気なあなたをなだめてくれ、リラックスした家庭を築けます。", partner2App: "相手は積極的ではないので、あなたが主導権を握り、はっきりした意思表示をするとお相手も安心できます。", failFactor: "自立心が強すぎて人に甘えるのが苦手です。葛藤が生じると、拒絶を恐れて自分から関係を断つことがあります。", advice: "適度な甘えと忍耐力が必要です。少しのことは大目に見、話し合えば信頼はさらに深まります。" },
      9: { intro: "【穏和な癒し系の女性】", pattern: "楽観的でめったに慌てません。ゆったりした時間感覚を持ち、平和で心地よい世界を好むマイペースな人です。", attitude: "受け身的で誰でも受け入れます。黙ってうなずき、場を和ませる温かい雰囲気があります。葛藤を避けます。", traits: "素朴で飾らず、平穏な暮らしを望みます。ふだんは温厚ですが、頑固に譲らない面も持っています。", marriage: "恋も受け身。相手からのアプローチを優先し、パートナーと一体化する感じを持ちます。平和な毎日を願います。", partner1Type: "タイプ８", partner1Rel: "力強く行動的な男性がおすすめ。背中を押して引っ張ってくれる相手となら、活気ある生活が送れます。", partner1App: "相手は「はっきり言ってほしい」タイプ。食事選びなど些細なことでも自分の意思表示をしましょう。", partner2Type: "タイプ９", partner2Rel: "同じく穏やかな方も。時間はかかりますが絆は深くなり、いつも一緒にいるオシドリ夫婦になれるでしょう。", partner2App: "両方受け身なのであなたからアプローチを。希望をはっきり伝えないと話が進展しません。", failFactor: "自信を持てず消極的。いいなと思った人に近づけず、乗り気でない誘いを断れないこともあります。", advice: "自分に自信を持ちましょう。ファッション等を変えるのも有効。意思表示で自分の気持ちを守れます。" }
    }
  };

  const FORM_NAME = "personalityDiagnosisQuestions";

  // 質問リスト（21問）
  const QUESTION_LIST = [
    { no: "01", question: "性別を選択してください", answer1: "男性", answer2: "女性", answer3: "", answer1Type: "male", answer2Type: "female", answer3Type: "" },
    { no: "02", question: "周りの人と勝ち負けや順番を決める競争になったとしたら、あなたの本音は……", answer1: "もちろん、自分が一番になりたい。", answer2: "一番より二番めあたりがいい。", answer3: "競争からは降りていたい。", answer1Type: "a", answer2Type: "b", answer3Type: "c" },
    { no: "03", question: "プライベートで自分がやりたいことで何か重要なことを決断するときは……", answer1: "信頼できる人に相談してから決める。", answer2: "決めるまでに、また決めても行動に移るまでに時間がかかる。", answer3: "あまり迷わず自分で決断し、決めたらすぐ実行に移す。", answer1Type: "b", answer2Type: "c", answer3Type: "a" },
    { no: "04", question: "自分にとっては都合の悪い話や嫌な話を伝えられるときは……", answer1: "はっきり言ってもらった方がいい。", answer2: "あまりはっきり言われたくない。気をつかってほしい。", answer3: "", answer1Type: "a", answer2Type: "b", answer3Type: "" },
    { no: "05", question: "友人に対して、相手が聞いたら嫌だろうなと思うことを伝えなければならないとしたら……", answer1: "誤解のないようはっきり言っておいた方がいい。", answer2: "遠回しにわかるように話し相手に察してもらいたい。", answer3: "言わないで済ませたいので離れる。", answer1Type: "a", answer2Type: "b", answer3Type: "c" },
    { no: "06", question: "早い者勝ちで欲しいものが手に入るというとき、手を挙げろと言われたら……", answer1: "迷わず「ハイ、欲しいです」と手を挙げる。", answer2: "自分には手に入りそうにないなと思う。", answer3: "まず周りの人の出方を見る。", answer1Type: "a", answer2Type: "c", answer3Type: "b" },
    { no: "07", question: "あまり得意ではない家事で、一定量の作業を終わらせなければならないときは……", answer1: "さっさとやってさっさと終わらせる。", answer2: "始めるまでにも終わらせるにも時間がかかりそう。", answer3: "", answer1Type: "a", answer2Type: "c", answer3Type: "" },
    { no: "08", question: "友人や恋人と話をしているときは……", answer1: "自分が話していることが多く、「わたしは」という主語をよく使う。", answer2: "自分は聞き役に回り、人がしゃべっているのを聞くことが多い。", answer3: "相手の反応を気にしながら話し、譲り合う。", answer1Type: "a", answer2Type: "c", answer3Type: "b" },
    { no: "09", question: "友人や家族から、期待されていることがわかると……", answer1: "期待に応えられるようがんばりたい。", answer2: "期待されても困る。あまり期待されないほうがいい。", answer3: "", answer1Type: "b", answer2Type: "c", answer3Type: "" },
    { no: "10", question: "友人の集まりで決まりそうになった活動について、反対意見なら……", answer1: "「自分は反対」とはっきりその場で自分の意見を言う。", answer2: "多数決なら仕方がないので皆に合わせる。", answer3: "とくに何も言わないが、次第に身を引く。", answer1Type: "a", answer2Type: "b", answer3Type: "c" },
    { no: "11", question: "人前に出たり先頭に立ち、注目を浴びるようなことがあると……", answer1: "正直いい気分になり、ふだんよりも生き生きする。", answer2: "目立ちすぎると「出る杭は打たれる」と思い、気をつかう。", answer3: "あまり目立ちたくない。ふだんはなるべく人前には出たくない。", answer1Type: "a", answer2Type: "b", answer3Type: "c" },
    { no: "12", question: "いい知らせ、悪い知らせ、事務的な用件の三つを伝えるときは……", answer1: "いい知らせから伝える。", answer2: "悪い知らせから伝える。", answer3: "事務的な用件から伝える。", answer1Type: "x", answer2Type: "z", answer3Type: "y" },
    { no: "13", question: "あなたに対する周りの評価。わずかに否定的な意見もあるときは……", answer1: "否定的な評価で好意的な評価も台無しの気分になる。", answer2: "どちらの評価も受け入れ参考にする。", answer3: "否定的な方は気にせず忘れてしまう。", answer1Type: "z", answer2Type: "y", answer3Type: "x" },
    { no: "14", question: "困難な状況に直面したとき、より大切だと思われる態度は……", answer1: "事実を受け入れ、一つひとつの問題を解決していくこと。", answer2: "きっとうまくいくと信じ、明るい見通しを持ち続けること。", answer3: "", answer1Type: "x", answer2Type: "y", answer3Type: "" },
    { no: "15", question: "他人が感情をあらわにしているのを見ると……", answer1: "まあまあ、楽しくやろうよとなだめたくなる。", answer2: "感情丸出しでみっともないなあと思う。", answer3: "影響され、こっちまで気持ちがざわざわしてくる。", answer1Type: "x", answer2Type: "y", answer3Type: "z" },
    { no: "16", question: "心配事やちょっと厄介な問題を抱えてしまったときは……", answer1: "一人で抱えていると悶々とするが、人に話せばすっきりする。", answer2: "何とかなるだろうと、自然にいい方に考えてしまう。", answer3: "その問題を解決するために淡々と行動する。", answer1Type: "z", answer2Type: "x", answer3Type: "y" },
    { no: "17", question: "外出先で火の元や戸締りが思い出せないと……", answer1: "火事にならないか、泥棒が入らないかなどと心配になる。", answer2: "たぶん大丈夫だろうと思い、それほど心配しない。", answer3: "", answer1Type: "z", answer2Type: "x", answer3Type: "" },
    { no: "18", question: "大きなトラブルを抱えている友達に同意を求められたら……", answer1: "わからないと答える。", answer2: "大丈夫じゃないでしょと言う。", answer3: "大丈夫だよと言ってあげる。", answer1Type: "y", answer2Type: "z", answer3Type: "x" },
    { no: "19", question: "自分の悩み事について人に相談したとき、まず求めるのは……", answer1: "共感してくれなくてもいいので、有益なアドバイスがほしい。", answer2: "まずは自分の気持ちを汲み取ってほしい。", answer3: "", answer1Type: "y", answer2Type: "z", answer3Type: "" },
    { no: "20", question: "個人的には安泰の日々が続いていたら……", answer1: "このままずっと安泰の日々が続きそうな気がする。", answer2: "ただ自分のやりたいことややるべきことを続けていく。", answer3: "何かしら不安材料や気がかりなことが思い浮かぶ。", answer1Type: "x", answer2Type: "y", answer3Type: "z" },
    { no: "21", question: "いまから百年後の世界はどうなっているか……", answer1: "いまより悪くなっているのではないかと思う。", answer2: "きっといまよりよくなっているはずだ。", answer3: "わからないがいまよりよくなっていてほしい。", answer1Type: "z", answer2Type: "x", answer3Type: "y" },
  ];

  function prepareContents() {
    const $template_radioSet = $("#template_radioSet");
    const $template_radioSetItem = $("#template_radioSetItem");
    if ($template_radioSet.length === 0) { setTimeout(prepareContents, 100); return; }

    const template_radioSet = $template_radioSet.html();
    const template_radioSetItem = $template_radioSetItem.html();

    const $container = $("#personality-diagnosis--questions").empty();
    QUESTION_LIST.forEach((data, i) => {
      const index = i + 1;
      const clone = $(template_radioSet).attr("id", `q-${index}`);
      clone.find(".radioSetLegendNo").html(`Q ${("00" + index).slice(-2)}/21`);
      clone.find(".radioSetLegendTitle").html(data.question);
      const items = clone.find(".radioSetItems");
      
      const createItem = (no, type, label) => {
        const item = $(template_radioSetItem);
        const inputId = `q-${index}-ans-${no}`;
        item.find(".radioSetItemInput").attr({ id: inputId, name: FORM_NAME + ("00" + index).slice(-2), value: type, "data-index": index });
        item.find(".radioSetItemInputLabel").attr({ for: inputId }).html(label);
        return item;
      };

      items.append(createItem("1", data.answer1Type, data.answer1));
      items.append(createItem("2", data.answer2Type, data.answer2));
      if (data.answer3) items.append(createItem("3", data.answer3Type, data.answer3));
      $container.append(clone);
    });

    $("#personality-diagnosis--button").show().on("click", () => {
      const result = executeDiagnosis();
      if (result) {
        const reportHtml = `
          <div class="report-container">
            <div class="report-header">
              <h2>婚活性格診断結果報告書</h2>
              <div class="result-main-title">あなたは${result.intro}</div>
            </div>
            <div class="report-chapter">
              <span class="chapter-title">第1章：あなたの本質</span>
              <div class="item-label">考え方・行動パターン</div>
              <div class="item-text">${result.pattern}</div>
              <div class="item-label">対人態度</div>
              <div class="item-text">${result.attitude}</div>
              <div class="item-label">性格傾向</div>
              <div class="item-text">${result.traits}</div>
            </div>
            <div class="report-chapter">
              <span class="chapter-title">第2章：恋愛・結婚観</span>
              <div class="item-text">${result.marriage}</div>
            </div>
            <div class="report-chapter">
              <span class="chapter-title">第3章：理想のパートナー</span>
              <div class="partner-box">
                <span class="partner-type-badge">おすすめ①：${result.partner1Type}</span>
                <p><strong>【関係性】</strong><br>${result.partner1Rel}</p>
                <p class="u-mt8"><strong>【アプローチ】</strong><br>${result.partner1App}</p>
              </div>
              <div class="partner-box">
                <span class="partner-type-badge">おすすめ②：${result.partner2Type}</span>
                <p><strong>【関係性】</strong><br>${result.partner2Rel}</p>
                <p class="u-mt8"><strong>【アプローチ】</strong><br>${result.partner2App}</p>
              </div>
            </div>
            <div class="report-chapter">
              <span class="chapter-title">第4章：幸せへの鍵</span>
              <div class="item-label">うまくいかない要因は？</div>
              <div class="warning-box item-text">${result.failFactor}</div>
              <div class="item-label">ワンポイントアドバイス</div>
              <div class="item-text" style="border-left: 4px solid var(--color-primary);">${result.advice}</div>
            </div>
            <div class="report-seal">ONET 鑑定済</div>
          </div>
        `;
        $("#personality-diagnosis--modal .dialog").html(`<button type="button" class="dialogCloseButton">×</button>${reportHtml}`);
        $("#personality-diagnosis--modal").css("display", "flex");
      }
    });

    $(document).on("click", ".dialogCloseButton", () => { $("#personality-diagnosis--modal").hide(); });
    $(document).on("change", ".radioSetItemInput", (e) => { $(e.target).closest("fieldset").find(".radioSetItemsError").hide(); });
  }

  prepareContents();

  function executeDiagnosis() {
    const answers = [];
    const errors = [];
    for (let i = 1; i <= 21; i++) {
      const val = $(`input[name='${FORM_NAME + ("00" + i).slice(-2)}']:checked`).val();
      if (!val) errors.push(i); else answers[i] = val;
    }
    if (errors.length > 0) {
      errors.forEach(idx => $(`#q-${idx} .radioSetItemsError`).show());
      $("html, body").animate({ scrollTop: $(`#q-${errors[0]}`).offset().top - 80 }, 500);
      return;
    }
    const gender = answers[1]; 
    const type = calcResultType(answers);
    return RESULT_DETAILS[gender][type];
  }

  function calcResultType(ans) {
    // インデックス調整（Q1が性別のため性格診断は2〜21番）
    const arr1 = [ans[2], ans[3], ans[5], ans[6], ans[8], ans[10], ans[11]];
    const arr2 = [ans[12], ans[13], ans[15], ans[16], ans[18], ans[20], ans[21]];
    const ma = countIf(arr1, "a"), mb = countIf(arr1, "b"), mc = countIf(arr1, "c");
    const mx = countIf(arr2, "x"), my = countIf(arr2, "y"), mz = countIf(arr2, "z");
    const mabc = Math.max(ma, mb, mc), mxyz = Math.max(mx, my, mz);

    let abc = (ma===mabc?"a":"") + (mb===mabc?"b":"") + (mc===mabc?"c":"");
    if (abc === "ab") abc = ans[4]; else if (abc === "ac") abc = ans[7]; else if (abc === "bc") abc = ans[9]; else if (abc.length > 1) abc = abc[0];

    let xyz = (mx===mxyz?"x":"") + (my===mxyz?"y":"") + (mz===mxyz?"z":"");
    if (xyz === "xy") xyz = ans[14]; else if (xyz === "xz") xyz = ans[17]; else if (xyz === "yz") xyz = ans[19]; else if (xyz.length > 1) xyz = xyz[0];

    const typeMap = { "by": 1, "bx": 2, "ay": 3, "cz": 4, "cy": 5, "bz": 6, "ax": 7, "az": 8, "cx": 9 };
    return typeMap[abc + xyz] || 1;
  }

  function countIf(arr, val) { return arr.filter(v => v === val).length; }
});